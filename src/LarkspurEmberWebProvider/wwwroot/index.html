<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>Larkspur</title>
    <style type="text/css">
        body, html {
            margin: 0;
            padding: 0;
            font-family: roboto, Arial, Helvetica, sans-serif !important;
            -webkit-font-smoothing: subpixel-antialiased;
            -ms-text-size-adjust: 100%;
            -webkit-text-size-adjust: 100%;
            line-height: 1;
            background: #004dca;
            color: #e7f5ff;
        }

        /* body, html {
            margin: 0;
            padding: 0;
            font-family: roboto, Arial, Helvetica, sans-serif !important;
            -webkit-font-smoothing: subpixel-antialiased;
            -ms-text-size-adjust: 100%;
            -webkit-text-size-adjust: 100%;
            line-height: 1;
            background: #ffffff;
        } */
        .conf-container {
            margin: 0 auto;
            padding: 3vh 5vw;
            margin: 0;
        }
        .conf-site {
            font-size: 5vw;
            font-weight: 600;
            color: #000000;
            line-height: 1;
        }
        .conf-links {
            font-size: 1.5em;
            font-weight: 300;
            color: #5c22b3;
            display: block;
            width: 100%;
            padding: 2vh 0;
            text-align: right;
        }
        .conf-version {
            font-size: 3vw;
            font-weight: 200;
            line-height: 1.5;
        }
        .conf-environment {
            font-size: 3vw;
            font-weight: 600;
        }
        .conf-server {
            font-size: 3vw;
            font-weight: 400;
        }
        .conf-releasedate {
            font-size: 2.5vw;
            font-weight: 400;
            line-height: 1.5;
        }
        .conf-headline {
            margin-top: 3vh;
            font-weight: 400;
            font-size: 1.2em;
            padding: 5px 0;
        }
        .conf-form {
            padding: 1vh 0;
        }
        a {
            color: #4263e6;
            text-decoration: underline;
            cursor:pointer;
        }
        a:hover {
            color: #9a42ce;
            text-decoration: underline;
        }
        .doc-info-table {
            width: 100%;
            margin: 1vh 0;
            line-height: 1.5;
            border: 1px solid #a7a7a7;
            text-align: left;
            border-collapse: collapse;
        }
        .doc-info-table th {
            background: #e0e0e0;
            font-size: smaller;
            padding: 5px;
            font-size: 11pt;
        }
        .doc-info-table td {
            background: #7dff7d;
            padding: 5px;
            font-size: 11pt;
            border: 0;
            border-top: 1px solid #ebebeb;
        }
        .doc-info-table tr.offline td {
            background: #ffb6c1;
            padding: 5px;
            font-size: 11pt;
            border: 0;
            border-top: 1px solid #ebebeb;
        }
        .doc-info-table button {
            padding: 0 5px;
            min-height: unset;
        }
        .doc-link-ex a {
            text-transform: capitalize;
            text-decoration: underline;
        }
        .btn {
            line-height: 2;
            padding: 0.5vh 2vw;
            margin: 0 1vw 0 0;
            display: inline-block;
            font-size: 1em;
            cursor: pointer;
        }
        .current {
            background: #e7fffa;
            background: #e7fffa;
        }
        label.subheader {
            padding: 8px 0;
            margin: 0;
            display: block;
        }
        ::placeholder {
            color: lightgray;
            opacity: 1;
        }
        .header {
            display: block;
            font-size: 2em;
            font-weight: bold;
        }
        .small {
            font-size: 12px;
        }
        .unit {
            margin-top: 15px;
        }
        .codecs {
            width: 700px;
        }
        .codec-name {
            width: 200px;
            float: left
        }
        .codecs button {
            width: 90px
        }
        .codecs .vu-values {
            width: 170px;
            display: inline-block;
        }
        .codecs .updated {
            font-size: smaller;
        }
        button {
            background: #5f5f5f;
            border: 1px solid #313131;
            color: #fff;
            padding: 0 1em;
            min-height: 35px;
            font-size: 1em;
            cursor: pointer;
            -webkit-transition: all 0.2s;
            -moz-transition: all 0.2s;
            transition: all 0.2s;
            border-radius: 2px;
        }
        button:hover {
            background: #333333;
        }
        input, select {
            border: 0;
            padding: 0 0 0 10px;
            background: #fff;
            border: 1px solid #4c4c4c;
            font-size: 1em;
            border-radius: 0;
            outline: 0;
            -webkit-appearance: none;
            height: 35px;
            box-sizing: border-box;
            border-radius: 2px;
            min-width: 35%;
        }
        select {
            padding: 0 30px 0 10px;
            background-image: linear-gradient(45deg, transparent 50%, #000000 50%), linear-gradient(135deg, black 50%, transparent 50%), linear-gradient(to right, white, white);
            background-position: calc(100% - 16px) calc(0.8em + 2px), calc(100% - 11px) calc(0.8em + 2px), 100% 0;
            background-size: 5px 5px, 5px 5px, 2.5em 2.5em;
            background-repeat: no-repeat;
        }
        .screen {
            color: #67fcc7;
            animation: animation_green 1s linear infinite;
        }
        @keyframes animation_green {
            0% {
                fill: rgb(66 219 113 / 100%);
            }
            50% {
                fill: rgb(66 219 113 / 30%);
            }
            100% {
                fill: rgb(66 219 113 / 100%);
            }
        }
        @keyframes animation_red {
            0% {
                fill: rgb(219 66 66 / 100%);
            }
            50% {
                fill: rgb(219 66 66 / 30%);
            }
            100% {
                fill: rgb(219 66 66 / 100%);
            }
        }
        #plc-icon {
            width: 200px;
        }

        .plc--led .bulb {
            fill: #D3D3D3;
        }

        .plc--led .flare {
            fill: rgb(234 234 234 / 0.50);
        }

        .plc--led .bulb.poweron {
            animation: animation_green 1s linear infinite;
        }

        .plc--led .bulb.poweroff {
            animation: animation_red 1s linear infinite;
        }

        .st2 { fill:#28C677; }
        .st3 { fill:#1BAA5F; }
        .st4 { fill:#1E7A24; }

        .tree-state-list {
            padding: 0;
            margin: 0;
            width: 100%;
        }
        .tree-state-list li {
            padding: 0;
            margin: 0;
            width: 100%;
            display: grid;
            grid-template-columns: 2fr 1fr 0.5fr;
            grid-gap: 2em;
        }
        .tree-path {
            font-weight: normal;
        }
        .tree-value {
            font-weight: bold;
            color: #0bbc0b;
        }
        .tree-option {
            cursor: pointer;
            text-decoration: underline;
            padding: 0 0.3em;
        }
        .tree-option--non-writable {
            cursor: not-allowed;
            text-decoration: line-through;
            padding: 0 0.3em;
        }
        .tree-state-matrix {
            padding: 0;
            margin: 0;
            width: 100%;
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 0.2em;

        }
        .tree-state-matrix div {
            padding: 0;
            margin: 0;
            display: grid;
            justify-content: center;
            align-content: center;
        }
        .tree-state-matrix .matrix-signal {
            justify-self: center;
            width: 15px;
            height: 15px;
            text-align: center;
            vertical-align: middle;
            justify-content: center;
            border: 1px solid #dedede;
            border-radius: 50%;
            background: #f1f1f1;
        }
        .tree-state-matrix .matrix-label--source {
            text-align: center;
            justify-content: center;
            min-height: 1.5em;
        }
        .tree-state-matrix .matrix-label--target {
            text-align: left;
            justify-content: left;
            min-height: 1.5em;
        }
        .matrix-title {
            font-weight: 400;
            font-size: 1.6em;
            padding: 5px 0 !important;
            text-align: left;
            justify-content: left !important;
        }
        .matrix-signal--connected {
            background: #30ce29 !important;
            color: black;
            border-color: #4CAF50 !important;
            animation: splash 1s normal forwards ease-in-out;
        }
        .matrix-signal--connected.source_0 {
            border: 1px solid #969e95 !important;
            color: black;
            background: #a9bdaa !important;
            animation: splash 1s normal forwards ease-in-out;
        }

        @keyframes splash {
            from {
                opacity: 0;
                transform: scale(0, 0);
            }
            50% {
                opacity: 1;
                transform: scale(1.1, 1.1);
            }
            to {
                transform: scale(1, 1);
            }
        }

        .matrix-connection {
            display: block;
            font-size: 0.8em;
            line-height: 1.8;
        }
        .matrix-connection--on {

        }
        .matrix-connection:after {
            content: "\01F63F Offline";
        }
        .matrix-connection--on:after {
            content: "\01F37A Online";
        }
    </style>
</head>
<body>
<div class="container">
    <div class="conf-container">
        <h1>Larkspur</h1>
        <h3>Socket status "<span id="socketStatus"></span>"</h3>
    </div>

    <div class="conf-container">
        <div class="matrix-title">Tree</div>
        <div class="unit">
            <div class="row">
                <ul id="treeInitialList" class="tree-state-list"></ul>
            </div>
        </div>
    </div>

    <div class="conf-container">
        <div class="unit">
            <div class="row">
                <div id="matrixInitialTable">

                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@microsoft/signalr@3.1.3/dist/browser/signalr.min.js"></script>

<script type="text/javascript">
    "use strict";

    const EMBER_NODE_TYPES = {
        STRING: "string",
        NUMBER: "number",
        BOOLEAN: "boolean",
        UNKNOWN: "unknown"
    }

    class EmberTree {

        constructor() {
            this.nodes = {};
            this.treeRoot = {};
        }

        getNode(path) {
            let id = this.treeIdFromStringPath(path);
            if (this.nodes.hasOwnProperty(id)) {
                return this.nodes[id];
            } else {
                return false;
            }
        }

        updateDom(path, value) {
            let id = this.treeIdFromStringPath(path);
            let selectedElements = document.querySelectorAll("[data-key]");
            selectedElements.forEach(function(item) {
                let obj = JSON.parse(item.dataset.key);
                // console.log(obj);
                if (obj.id === id) {
                    window.requestAnimationFrame(function() {
                        switch(obj.type) {
                            case "class":
                                if (value) {
                                    if (!item.classList.contains(obj.value)) {
                                        item.classList.add(obj.value);
                                    }
                                } else {
                                    item.classList.remove(obj.value);
                                }
                                break;
                            default:
                                item.innerHTML = value;
                                break;
                        }
                    });
                }
            });
        }

        updateAllDomElements() {
            let elements = Object.entries(this.nodes);
            if (elements.length != 0) {
                elements.forEach((key, value) => {
                    this.updateDom(key[0], key[1].value);
                });
            } else {
                console.warn("No elements to update");
            }
        }

        updateNode(path, value) {
            let id = this.treeIdFromStringPath(path);
            if(this.nodes.hasOwnProperty(id)) {
                this.nodes[id].value = value;
                this.updateDom(path, value);
                return true;
            } else {
                return false;
            }
        }

        addNode(path, numericPath, value, isWritable) {
            let id = this.treeIdFromStringPath(path);
            try {
                if (this.nodes.hasOwnProperty(id)) {
                    this.nodes[id].value = value;
                } else {
                    this.nodes[id] = new EmberElement(id, path, numericPath, value, isWritable);
                }
            } catch(error) {
                console.error(error);
            }

            // Add new construction
            let pathArr = path.split("/");
            try {
                this.addNodeElement(this.nodes[id], pathArr, this.treeRoot);
            } catch(error) {
                console.error(error);
            }
        }

        addNodeElement(emberElement, pathArr, currentPointer) {
            if (pathArr.length == 0) {
                return true;
            }
            if (currentPointer.hasOwnProperty(pathArr[0])) {
                // Have the position been added to the tree?
                // If yes then just point to that
                return this.addNodeElement(emberElement, pathArr.slice(1), currentPointer[pathArr[0]])
            } else {
                // There is no node at this position, so add a new node
                if (pathArr.length == 1) {
                    currentPointer[pathArr[0]] = emberElement;
                } else {
                    currentPointer[pathArr[0]] = new EmberNode(pathArr[0]);
                }
                return this.addNodeElement(emberElement, pathArr.slice(1), currentPointer[pathArr[0]])
            }
        }

        getNodeChildren(pathArr) {
            this.findNodeChildren(pathArr, this.treeRoot)
        }

        findNodeChildren(pathArr, currentPointer) {
            if (pathArr.length == 0) {
                return currentPointer;
            }
            if (currentPointer.hasOwnProperty(pathArr[0])) {
                // Have the position been added to the tree?
                // If yes then just point to that
                return this.findNodeChildren(emberElement, pathArr.pop(), currentPointer[pathArr[0]])
            } else {
                // There is no node at this position, so add a new node
                return false;
            }
        }

        treeIdFromStringPath(path) {
            if (!path) {
                return "no_path_available";
            }
            return path.split("/").join("").toLowerCase().replace(" ", "_");
        }

        treeIdParentFromStringPath(path, parentCount) {
            let arr = path.split("/");
            parentCount = parentCount || 1;
            arr.splice(-parentCount);
            return arr.join("").toLowerCase().replace(" ", "_");
        }

        buildDomListItem(path, idPrefix) {
            let data = this.getNode(path);

            let li = document.createElement("LI");

            // Add path information
            let dv1 = document.createElement("DIV");
            dv1.classList.add("tree-path");
            dv1.textContent = path;
            li.appendChild(dv1);

            // Add actual values
            let dv2 = document.createElement("DIV");
            dv2.classList.add("tree-value");
            dv2.textContent = data.value;
            dv2.id = idPrefix + this.treeIdFromStringPath(path);
            dv2.contentEditable = "true";
            dv2.addEventListener("input", function(data) {
                console.log("Content editable: ", data.srcElement.textContent);
            }, false);
            li.appendChild(dv2);

            // Add edit button
            if (data.isWritable) {
                let dvo = document.createElement("DIV");
                dvo.classList.add("tree-options");

                if (typeof (data.value) === "string") {
                    let dvlink = document.createElement("A");
                    dvlink.classList.add("tree-option");
                    dvlink.textContent = "change";
                    let ofn = "emberChangeString(this,'"+path+"','"+data.value+"','"+data.numericPath+"')";
                    dvlink.setAttribute("onclick", ofn);
                    dvo.append(dvlink);
                }
                if (typeof (data.value) === "number") {
                    let dvlink = document.createElement("A");
                    dvlink.classList.add("tree-option");
                    dvlink.textContent = "change";
                    let ofn = "emberChangeNumber(this,'"+path+"','"+data.value+"','"+data.numericPath+"')";
                    dvlink.setAttribute("onclick", ofn);
                    dvo.append(dvlink);
                }
                if (typeof (data.value) === "boolean") {
                    let linktrue = document.createElement("A");
                    linktrue.classList.add("tree-option");
                    linktrue.textContent = "true";
                    let ofntrue = "emberChangeBoolean(this,'"+path+"','true','"+data.numericPath+"')";
                    linktrue.setAttribute("onclick", ofntrue);
                    dvo.append(linktrue);

                    let linkfalse = document.createElement("A");
                    linkfalse.classList.add("tree-option");
                    linkfalse.textContent = "false";
                    let ofnfalse = "emberChangeBoolean(this,'"+path+"','false','"+data.numericPath+"')";
                    linkfalse.setAttribute("onclick", ofnfalse);
                    dvo.append(linkfalse);
                }
                li.appendChild(dvo);
            } else {
                let dvo = document.createElement("DIV");
                dvo.classList.add("tree-options");
                let dvlink = document.createElement("SPAN");
                dvlink.classList.add("tree-option--non-writable");
                dvlink.textContent = "change";
                dvo.append(dvlink);
                li.appendChild(dvo);
            }

            return li;
        }
    }

    class EmberNode {
        constructor(nodeName) {
            this.nodeName = nodeName;
        }
    }

    class EmberElement {
        constructor(nodeId, path, numericPath, value, isWritable) {
            this.nodeId = nodeId;
            this.path = path;
            this.numericPath = numericPath;
            this.value = value;
            this.typeToDef(value);
            this.isWritable = isWritable;
        }

        typeToDef(type) {
            switch(typeof(type)) {
                case EMBER_NODE_TYPES.STRING:
                    this.type = EMBER_NODE_TYPES.STRING;
                    break;
                case EMBER_NODE_TYPES.NUMBER:
                    this.type = EMBER_NODE_TYPES.NUMBER;
                    break;
                case EMBER_NODE_TYPES.BOOLEAN:
                    this.type = EMBER_NODE_TYPES.BOOLEAN;
                    break;
                default:
                    this.type = EMBER_NODE_TYPES.UNKNOWN;
                    break;
            }
        }
    }

    var emberTree = new EmberTree();

    function DataKey(id, type, value) {
        this.id = id || "#";
        this.type = type || "#";
        this.value = value || "#";
    }

    DataKey.prototype.toString = function dogToString() {
        return JSON.stringify(this);
    }

    var connection = new signalR.HubConnectionBuilder()
        .withUrl("/larkspurHub")
        .withAutomaticReconnect()
        .build();

    setSocketConnectionFeedback("Disconnected");

    connection.on("InitialEmberTree", (tree) => {
        console.log(`Event 'InitialEmberTree': ${JSON.stringify(tree)}`);
        let arr = Object.entries(tree).sort();
        for (let i = 0; i < arr.length; i++) {
            //console.log(`Item: '${arr[i][0]}' Value: '${arr[i][1].value}' TypeOf: '${typeof(arr[i][1].value)}'`);
            // Build an object for each
            emberTree.addNode(arr[i][0], arr[i][1].numericPath, arr[i][1].value, arr[i][1].isWritable);

            // Add DOM objects
            let li = emberTree.buildDomListItem(arr[i][0], "id_");
            li.id = "id_row_" + emberTree.treeIdFromStringPath(arr[i][0]);
            document.getElementById("treeInitialList").prepend(li);
        }

        console.log(emberTree.nodes);
    });

    connection.on("ChangesInEmberTree", (path, data) => {
        console.log(`Event 'ChangesInEmberTree', path:${JSON.stringify(path)}, data:${JSON.stringify(data)}`);
        // Update internal object
        emberTree.updateNode(path, data.value);
        console.log(emberTree.getNode(path));

        // Update DOM object
        let li = emberTree.buildDomListItem(path, "idrow_");
        document.getElementById("id_" + emberTree.treeIdFromStringPath(path)).innerHTML = data.value;
    });

    connection.on("InitialEmberTreeMatrix", (matrices) => {
        console.log(`Event 'InitialEmberTreeMatrix': ${JSON.stringify(matrices)}`);
        document.getElementById("matrixInitialTable").innerHTML = "";
        let arr = Object.entries(matrices).sort();
        for (let i = 0; i < arr.length; i++) {
            let frag = buildMatrixView(arr[i][0], arr[i][1]);
            document.getElementById("matrixInitialTable").append(frag);
        }

        emberTree.updateAllDomElements();
    });

    connection.on("ChangesInEmberTreeMatrix", (path, target) => {
        console.log(`Event 'ChangesInEmberTree', path:${JSON.stringify(path)}, target:${JSON.stringify(target)}`);

        // Remove all connected sources from target
        let targetBoxes = document.querySelectorAll(".matrix-signal_" + target.index + "_" + emberTree.treeIdFromStringPath(path));
        targetBoxes.forEach(function(item) {
            item.classList.remove("matrix-signal--connected");
        });

        // Connect target with source
        for (let i = 0; i < target.connectedSources.length; i++) {
            document.getElementById("id_signal_" + target.connectedSources[i] + "_" + target.index + "_" + emberTree.treeIdFromStringPath(path)).classList.add("matrix-signal--connected");
        }
    });

    connection.start()
        .then(function () {
            setSocketConnectionFeedback(connection.connectionState);
            connection.invoke("RequestInitialState").catch((err) => {
                return console.error("Could not request initial state", err);
            });
        })
        .catch(function (err) {
            setSocketConnectionFeedback("Error " + err.toString());
            return console.error(err.toString());
        });

    connection.onclose(function() {
        console.log("connection onclose");
        setSocketConnectionFeedback(connection.connectionState);
    });

    connection.onreconnecting(function(error) {
        console.log("connection onreconnecting", error);
        setSocketConnectionFeedback(connection.connectionState);
    });

    connection.onreconnected(function() {
        console.log("connection onreconnected");
        setSocketConnectionFeedback(connection.connectionState);

        connection.invoke("RequestInitialState").catch((err) => {
            return console.error("Could not request initial state", err);
        });
    });

    function setSocketConnectionFeedback(message) {
        document.getElementById("socketStatus").textContent = message;
    }

    function buildMatrixView(path, matrix) {
        try {
            let frag = document.createDocumentFragment();

            let box = document.createElement("DIV");
            box.classList.add("tree-state-matrix");
            box.id = emberTree.treeIdFromStringPath(path);

            if (matrix.hasOwnProperty("sources") && matrix.hasOwnProperty("targets")) {

                // Add matrix label
                let lbl = document.createElement("DIV");
                lbl.classList.add("matrix-title");
                lbl.style.gridColumn = `1 / span ${matrix.sources.length + 1}`;
                lbl.textContent = matrix.name;
                let state = document.createElement("SPAN");
                state.classList.add("matrix-connection");
                state.setAttribute("data-key", new DataKey(emberTree.treeIdParentFromStringPath(path, 2) + "connection", "class", "matrix-connection--on"));
                state.textContent = "Connection";
                lbl.append(state);
                box.append(lbl);

                // Add top left corner
                let div = document.createElement("DIV");
                div.classList.add("matrix-origo");
                box.append(div);

                // Add matrix
                let sources = matrix.sources;
                for (let i = 0; i < sources.length; i++) {
                    // Source label
                    let div = document.createElement("DIV");
                    // div.id = "id_source_" + sources[i].index;
                    div.textContent = sources[i].name;
                    div.classList.add("matrix-label--source");
                    div.setAttribute("data-key", new DataKey(emberTree.treeIdFromStringPath(sources[i].labelPath)));
                    box.append(div);
                }

                let targets = matrix.targets;
                for (let i = 0; i < targets.length; i++) {
                    // Target label
                    let div = document.createElement("DIV");
                    // div.id = "id_target_" + targets[i].index;
                    div.textContent = targets[i].name;
                    div.classList.add("matrix-label--target");
                    div.setAttribute("data-key", new DataKey(emberTree.treeIdFromStringPath(targets[i].labelPath)));
                    box.append(div);

                    // Signals
                    for (let y = 0; y < sources.length; y++) {
                        let signal = document.createElement("DIV");
                        signal.classList.add("matrix-signal");
                        signal.classList.add("source_" + y);
                        signal.classList.add("matrix-signal_" + targets[i].index + "_" + emberTree.treeIdFromStringPath(path));
                        signal.id = "id_signal_" + sources[y].index + "_" + targets[i].index + "_" + emberTree.treeIdFromStringPath(path);

                        // Actually connect
                        if (targets[i].connectedSources.length !== 0) {
                            targets[i].connectedSources.forEach((item) => {
                                if (item === sources[y].index) {
                                    signal.classList.add("matrix-signal--connected");
                                }
                            });
                        }

                        box.append(signal);
                    }
                }
            }

            box.style.gridTemplateColumns = `2fr repeat(${matrix.sources.length}, 1fr)`;
            frag.append(box);
            return frag;
        } catch(err) {
            console.warn(err);
            return document.createDocumentFragment();
        }
    }

    function emberChangeString(element, path, value, numericPath) {
        let change = window.prompt(`Change string`, value);
        if (change !== null) {
            connection.invoke("ChangeEmberStringParameter", numericPath, change).catch((err) => {
                return console.error("Could not send change", err);
            });
        }
    }

    function emberChangeNumber(element, path, value, numericPath) {
        let change = window.prompt(`Change number`, value);
        if (change !== null) {
            connection.invoke("ChangeEmberNumberParameter", numericPath, parseInt(change)).catch((err) => {
                return console.error("Could not send change", err);
            });
        }
    }

    function emberChangeBoolean(element, path, value, numericPath) {
        let state = value == "true" ? true : false;
        connection.invoke("ChangeEmberBooleanParameter", numericPath, state ).catch((err) => {
            return console.error("Could not send change", err);
        });
    }

    /* Custom Event */
    // class UserFeedbackEvent {
    //     identifier = null;
    //     active = false;
    //     error = undefined;
    //     timer = undefined;

    //     constructor(identifier, active, error, timer) {
    //         this.identifier = identifier || null;
    //         this.active = active;
    //         this.error = error;
    //         this.timer = timer;
    //     }

    //     getMessage = () => {
    //         let message = { detail: {} };
    //         message.detail[this.identifier] = {};
    //         if (typeof this.active !== "undefined") {
    //             message.detail[this.identifier].active = this.active;
    //         };
    //         if (typeof this.error !== "undefined") {
    //             message.detail[this.identifier].error = this.error;
    //         };
    //         if (typeof this.timer !== "undefined") {
    //             message.detail[this.identifier].timer = this.timer;
    //         };
    //         return message;
    //     }

    //     create = (eventName) => {
    //         return new CustomEvent(eventName, this.getMessage());
    //     }
    // }

    // window.addEventListener("embertree_changed",
    //     function(event) {
    //         if (!event) return;
    //         let e = event.detail;
    //         console.log("Received event:", e);
    //     });

    // window.dispatchEvent( new UserFeedbackEvent("EmbertreeChanged", true, "Wooppie", 6000).create("embertree_changed") );

</script>
</body>
</html>